<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BESS Analytics - Capacity Optimizer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <h1>BESS Analytics - Capacity Optimizer</h1>
            <button id="helpButton" class="help-btn" title="How to Use">‚ùì Help</button>
        </div>
        
        <div class="import-section">
            <div style="margin-bottom: 20px;">
                <label><strong>1. Solar Generation Data (PV):</strong></label><br>
                <input type="file" id="solarInput" accept=".csv">
            </div>
            
            <div style="margin-bottom: 20px;">
                <label><strong>2. Grid Meter Data (Import/Export):</strong></label><br>
                <input type="file" id="gridInput" accept=".csv">
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <label><strong>Or try with demo data:</strong></label><br>
                <button id="loadDemoBtn" class="demo-load-btn">üìä Load Demo Scenarios</button>
            </div>
        </div>

        <div id="datePickerSection" class="import-section" style="margin-top: 25px; display: none;">
            <h3>Simulation Period</h3>
            
            <div class="time-range-controls">
                <label class="range-label">Time Range:</label>
                <div class="preset-buttons">
                    <button class="preset-btn" data-preset="week">Week</button>
                    <button class="preset-btn" data-preset="month">Month</button>
                    <button class="preset-btn" data-preset="year">Year</button>
                    <button class="preset-btn" data-preset="full">Full Range</button>
                    <button class="preset-btn active" data-preset="custom">Custom</button>
                </div>
                
                <div class="nav-buttons">
                    <button class="nav-btn" id="btnPrevRange" title="Previous period">‚Üê</button>
                    <button class="nav-btn" id="btnNextRange" title="Next period">‚Üí</button>
                </div>
                
                <button class="current-btn" id="btnCurrent">Current</button>
            </div>

            <div id="customDateInputs" class="custom-date-inputs">
                <div class="date-input-group">
                    <label>Start Date & Time</label>
                    <input type="datetime-local" id="startDate">
                </div>
                <div class="date-input-group">
                    <label>End Date & Time</label>
                    <input type="datetime-local" id="endDate">
                </div>
            </div>

            <button id="runSimulation" class="apply-range-btn">Apply Range for Simulation</button>
            
            <div id="dataStatus" class="data-status"></div>
        </div>

        <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

        <div id="viewToggleContainer" style="margin-top: 30px; display:none;">
            <div class="button-group">
                <button id="btnShowPower" class="view-toggle-btn">Show Solar Power (kW)</button>
                <button id="btnShowEnergy" class="view-toggle-btn active">Show Solar Energy (kWh)</button>
            </div>
        </div>

        <div id="chartContainer" style="margin-top: 10px; height: 600px; width: 100%; display:none;"></div>

        <!-- Battery Configuration Section -->
        <div id="batteryConfigSection" class="import-section" style="margin-top: 25px; display: none;">
            <h3>üîã Battery Configuration</h3>
            
            <!-- TEMPORARY WARNING - REMOVE WHEN READY -->
            <div class="dev-warning">
                ‚ö†Ô∏è <strong>UNDER DEVELOPMENT:</strong> Battery simulation algorithm is currently under development and testing. Results may not be accurate. Use for testing purposes only.
            </div>
            
            <div id="simulationTimeRange" class="simulation-time-info" style="display: none;">
                üìÖ <strong>Simulation Period:</strong> <span id="simPeriodDisplay">Not set</span>
            </div>
            
            <div class="config-grid">
                <div class="config-item">
                    <label for="batteryCapacity">Capacity (kWh):</label>
                    <input type="number" id="batteryCapacity" min="1" max="5000" step="0.1" value="10">
                </div>
                
                <div class="config-item">
                    <label for="chargeEfficiency">Charge Efficiency (%):</label>
                    <input type="number" id="chargeEfficiency" min="80" max="100" step="0.1" value="96">
                </div>
                
                <div class="config-item">
                    <label for="dischargeEfficiency">Discharge Efficiency (%):</label>
                    <input type="number" id="dischargeEfficiency" min="80" max="100" step="0.1" value="92">
                </div>
                
                <div class="config-item">
                    <label for="maxChargeRate">Max Charge Rate (kW):</label>
                    <input type="number" id="maxChargeRate" min="1" max="50" step="0.1" value="5">
                </div>
                
                <div class="config-item">
                    <label for="maxDischargeRate">Max Discharge Rate (kW):</label>
                    <input type="number" id="maxDischargeRate" min="1" max="50" step="0.1" value="5">
                </div>
                
                <div class="config-item">
                    <label for="minSoc">Min SOC (%):</label>
                    <input type="number" id="minSoc" min="0" max="50" step="1" value="10">
                </div>
                
                <div class="config-item">
                    <label for="maxSoc">Max SOC (%):</label>
                    <input type="number" id="maxSoc" min="50" max="100" step="1" value="90">
                </div>
                
                <div class="config-item">
                    <label for="inverterMode">Inverter Mode:</label>
                    <select id="inverterMode">
                        <option value="asymmetric" selected>Asymmetric (Net Metering)</option>
                        <option value="symmetric">Symmetric (Separate Flows)</option>
                    </select>
                </div>
                
                <div class="config-item">
                    <label for="currency">Currency:</label>
                    <select id="currency">
                        <option value="HUF" selected>HUF (Ft)</option>
                        <option value="EUR">EUR (‚Ç¨)</option>
                    </select>
                </div>
            </div>
            
            <button id="btnRunBatterySimulation" class="run-simulation-btn">Run Battery Simulation</button>
            
            <!-- NEW: Battery Optimization Curve Button -->
            <button id="btnRunOptimizationCurve" class="run-simulation-btn" style="margin-top: 10px;">
                üìä Calculate Battery Optimization Curve
            </button>
            
            <!-- NEW: Progress Bar -->
            <div id="optimizationProgressContainer" style="display: none; margin-top: 10px;">
                <div style="background: #30363d; border-radius: 8px; height: 30px; overflow: hidden; position: relative;">
                    <div id="optimizationProgressBar" style="background: linear-gradient(90deg, #a855f7, #c084fc); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    <div id="optimizationProgressText" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #e6edf3; font-weight: 600; font-size: 13px;">
                        Calculating: 0/11 simulations
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulation Results Section -->
        <div id="simulationResults" style="margin-top: 30px; display: none;">
            <h3>üìä Simulation Results</h3>
            
            <!-- Energy KPI Cards -->
            <div class="kpi-cards">
                <div class="kpi-card kpi-success">
                    <div class="kpi-label">Grid Import Reduction</div>
                    <div class="kpi-value" id="kpiImportReduction">0 kWh</div>
                    <div class="kpi-subtitle" id="kpiImportPercent">0%</div>
                </div>
                
                <div class="kpi-card kpi-success">
                    <div class="kpi-label">Grid Export Reduction</div>
                    <div class="kpi-value" id="kpiExportReduction">0 kWh</div>
                    <div class="kpi-subtitle" id="kpiExportPercent">0%</div>
                </div>
                
                <div class="kpi-card kpi-info">
                    <div class="kpi-label">Battery Self-Consumption</div>
                    <div class="kpi-value" id="kpiBatterySelfConsumption">0 kWh</div>
                    <div class="kpi-subtitle">Additional solar used</div>
                </div>
                
                <div class="kpi-card kpi-warning">
                    <div class="kpi-label">Battery Losses</div>
                    <div class="kpi-value" id="kpiBatteryLosses">0 kWh</div>
                    <div class="kpi-subtitle" id="kpiLossPercent">0%</div>
                </div>
            </div>
            
            <!-- Financial KPI Cards -->
            <div class="kpi-cards" style="margin-top: 20px;">
                <div class="kpi-card kpi-financial">
                    <div class="kpi-label">Baseline Cost</div>
                    <div class="kpi-value" id="kpiBaselineCost">0 Ft</div>
                    <div class="kpi-subtitle">Without battery</div>
                </div>
                
                <div class="kpi-card kpi-financial">
                    <div class="kpi-label">Battery Scenario Cost</div>
                    <div class="kpi-value" id="kpiBatteryCost">0 Ft</div>
                    <div class="kpi-subtitle">With battery</div>
                </div>
                
                <div class="kpi-card kpi-financial kpi-highlight">
                    <div class="kpi-label">Total Savings</div>
                    <div class="kpi-value" id="kpiTotalSavings">0 Ft</div>
                    <div class="kpi-subtitle" id="kpiSavingsPercent">0%</div>
                </div>
            </div>
            
            <!-- Tier1 Limit Info -->
            <div id="tier1LimitInfo" class="info-text" style="text-align: center; margin-top: 15px; color: #a0a0a0; font-size: 0.9em;"></div>
            
            <!-- Solar Self-Consumption Comparison -->
            <div class="solar-comparison">
                <h4>‚òÄÔ∏è Solar Self-Consumption</h4>
                <div class="comparison-cards">
                    <div class="comparison-card">
                        <div class="card-title">Before (No Battery)</div>
                        <div class="card-value" id="beforeSelfConsumption">0 kWh</div>
                        <div class="card-rate" id="beforeSelfConsumptionRate">0%</div>
                    </div>
                    
                    <div class="comparison-card highlight">
                        <div class="card-title">After (With Battery)</div>
                        <div class="card-value" id="afterSelfConsumption">0 kWh</div>
                        <div class="card-rate" id="afterSelfConsumptionRate">0%</div>
                    </div>
                    
                    <div class="comparison-card improvement">
                        <div class="card-title">Improvement</div>
                        <div class="card-value" id="improvementSelfConsumption">+0 kWh</div>
                        <div class="card-rate" id="improvementSelfConsumptionRate">+0%</div>
                    </div>
                </div>
            </div>
            
            <!-- Comparison Chart -->
            <div id="comparisonChart" style="margin-top: 30px; height: 500px; width: 100%"></div>
            
            <!-- Energy Flow Chart Section -->
            <div id="energyFlowChartSection" style="display: none; margin-top: 30px;">
                <h3 style="margin-bottom: 15px; color: var(--text-color);">Energy Flow: Original vs Optimized</h3>
                <div class="button-group" style="margin-bottom: 10px;">
                    <button id="btnEnergyFlowPower" class="view-toggle-btn">Show Solar Power (kW)</button>
                    <button id="btnEnergyFlowEnergy" class="view-toggle-btn active">Show Solar Energy (kWh)</button>
                </div>
                <div id="energyFlowChartContainer" style="height: 600px; width: 100%;"></div>
            </div>
            
            <!-- Battery Optimization Curve Section -->
            <div id="optimizationCurveSection" style="display: none; margin-top: 30px;">
                <h3 style="margin-bottom: 15px; color: var(--text-color);">
                    Battery Optimization Curve
                </h3>
                
                <!-- Metric Toggle + CSV Export -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div class="button-group">
                        <button id="btnOptimCurveImport" class="view-toggle-btn active">Grid Import Reduction</button>
                        <button id="btnOptimCurveExport" class="view-toggle-btn">Grid Export Reduction</button>
                    </div>
                    <button id="btnExportOptimizationCSV" style="background: #2f81f7; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500;">
                        üì• Export CSV
                    </button>
                </div>
                
                <!-- Chart Container -->
                <div id="optimizationCurveContainer" style="height: 600px; width: 100%;"></div>
            </div>
        </div>

        <div id="output" style="margin-top: 20px; white-space: pre-wrap; font-family: monospace; font-size: 12px; background: #f4f4f4; padding: 10px;">
            Waiting for files...
        </div>
    </div>

    <footer>
        <p id="version-info"></p>
    </footer>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="helpModalTitle">How to Use</h2>
                <div class="language-toggle">
                    <button class="lang-btn active" data-lang="en">EN</button>
                    <button class="lang-btn" data-lang="hu">HU</button>
                </div>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Tab Navigation -->
                <div class="help-tabs">
                    <button class="tab-btn active" data-section="getting-started">
                        <span class="tab-text-en">Getting Started</span>
                        <span class="tab-text-hu" style="display:none;">Els≈ë l√©p√©sek</span>
                    </button>
                    <button class="tab-btn" data-section="time-range">
                        <span class="tab-text-en">Time Range</span>
                        <span class="tab-text-hu" style="display:none;">Id≈ëszak</span>
                    </button>
                    <button class="tab-btn" data-section="battery-config">
                        <span class="tab-text-en">Battery Setup</span>
                        <span class="tab-text-hu" style="display:none;">Be√°ll√≠t√°sok</span>
                    </button>
                    <button class="tab-btn" data-section="simulation">
                        <span class="tab-text-en">Simulation</span>
                        <span class="tab-text-hu" style="display:none;">Szimul√°ci√≥</span>
                    </button>
                    <button class="tab-btn" data-section="concepts">
                        <span class="tab-text-en">Key Concepts</span>
                        <span class="tab-text-hu" style="display:none;">Fogalmak</span>
                    </button>
                    <button class="tab-btn" data-section="troubleshoot">
                        <span class="tab-text-en">Help</span>
                        <span class="tab-text-hu" style="display:none;">Seg√≠ts√©g</span>
                    </button>
                </div>
                
                <!-- Content Sections -->
                <div class="help-content">
                    <!-- Section 1: Getting Started -->
                    <div id="section-getting-started" class="help-section active">
                        <div class="lang-en">
                            <h3>üìÅ Loading Your Data</h3>
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Solar Generation Data</h4>
                                        <p>Click <strong>"1. Solar Generation Data"</strong> and select your PV production CSV file.</p>
                                        <div class="info-box">
                                            <strong>Required format:</strong>
                                            <ul>
                                                <li>2 columns: <code>Timestamp, Production (kW)</code></li>
                                                <li>15-minute intervals</li>
                                                <li>Flexible date formats accepted:
                                                    <ul>
                                                        <li><code>YYYY-MM-DD HH:mm</code> (e.g., 2024-10-01 14:30)</li>
                                                        <li><code>M/D/YYYY H:mm</code> (e.g., 1/1/2024 0:15)</li>
                                                        <li><code>YYYY.MM.DD. HH:mm</code> (e.g., 2024.10.01. 14:30)</li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
      <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Grid Meter Data</h4>
                                        <p>Click <strong>"2. Grid Meter Data"</strong> and select your import/export CSV file.</p>
                                        <div class="info-box">
                                            <strong>Required format:</strong>
                                            <ul>
                                                <li>3 columns: <code>Timestamp, Import (kWh), Export (kWh)</code></li>
                                                <li>15-minute energy intervals</li>
                                                <li>Flexible date formats (can differ from solar file):
                                                    <ul>
                                                        <li><code>YYYY-MM-DD HH:mm</code></li>
                                                        <li><code>M/D/YYYY H:mm</code></li>
                                                        <li><code>YYYY.MM.DD. HH:mm</code></li>
                                                    </ul>
                                                </li>
                                                <li>Note: Timestamps don't need to match solar format</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="margin-top: 30px;">üìä Try Demo Data</h3>
                            <p>Not ready with your own data? No problem!</p>
                            <ul>
                                <li>Click <strong>"üìä Load Demo Scenarios"</strong> to test with pre-loaded sample data</li>
                                <li>This loads realistic solar + grid data for testing</li>
                                <li>Perfect for learning the interface before using your own data</li>
                            </ul>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>üìÅ Saj√°t adatok bet√∂lt√©se</h3>
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Napelemes termel√©si adatok</h4>
                                        <p>Kattints az <strong>"1. Solar Generation Data"</strong> gombra √©s v√°laszd ki a napelemes CSV f√°jlt.</p>
                                        <div class="info-box">
                                            <strong>Sz√ºks√©ges form√°tum:</strong>
                                            <ul>
                                                <li>2 oszlop: <code>Id≈ëb√©lyeg, Termel√©s (kW)</code></li>
                                                <li>15 perces felbont√°s</li>
                                                <li>Rugalmas d√°tum form√°tumok elfogadva:
                                                    <ul>
                                                        <li><code>√â√â√â√â-HH-NN √ì√ì:pp</code> (pl. 2024-10-01 14:30)</li>
                                                        <li><code>H/N/√â√â√â√â √ì:pp</code> (pl. 1/1/2024 0:15)</li>
                                                        <li><code>√â√â√â√â.HH.NN. √ì√ì:pp</code> (pl. 2024.10.01. 14:30)</li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>H√°l√≥zati m√©r≈ë adatok</h4>
                                        <p>Kattints a <strong>"2. Grid Meter Data"</strong> gombra √©s v√°laszd ki az import/export CSV f√°jlt.</p>
                                        <div class="info-box">
                                            <strong>Sz√ºks√©ges form√°tum:</strong>
                                            <ul>
                                                <li>3 oszlop: <code>Id≈ëb√©lyeg, Import (kWh), Export (kWh)</code></li>
                                                <li>15 perces energia intervallumok</li>
                                                <li>Rugalmas d√°tum form√°tumok (napelemes f√°jlt√≥l elt√©rhet):
                                                    <ul>
                                                        <li><code>√â√â√â√â-HH-NN √ì√ì:pp</code></li>
                                                        <li><code>H/N/√â√â√â√â √ì:pp</code></li>
                                                        <li><code>√â√â√â√â.HH.NN. √ì√ì:pp</code></li>
                                                    </ul>
                                                </li>
                                                <li>Megjegyz√©s: Az id≈ëb√©lyegek form√°tuma nem kell egyezzen a napelemes f√°jl√©val</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="margin-top: 30px;">üìä P√©lda adatok kipr√≥b√°l√°sa</h3>
                            <p>M√©g nincsenek saj√°t adataid? Semmi gond!</p>
                            <ul>
                                <li>Kattints a <strong>"üìä Load Demo Scenarios"</strong> gombra minta adatok bet√∂lt√©s√©hez</li>
                                <li>Ez val√≥s√°gh≈± napelemes + h√°l√≥zati adatokat t√∂lt be tesztel√©shez</li>
                                <li>T√∂k√©letes a fel√ºlet megismer√©s√©hez saj√°t adatok felt√∂lt√©se el≈ëtt</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Section 2: Time Range -->
                    <div id="section-time-range" class="help-section" style="display:none;">
                        <div class="lang-en">
                            <h3>‚è±Ô∏è Setting the Simulation Period</h3>
                            
                            <h4>Quick Selection Buttons</h4>
                            <div class="button-showcase">
                                <span class="demo-btn">Week</span>
                                <span class="demo-btn">Month</span>
                                <span class="demo-btn">Year</span>
                                <span class="demo-btn">Full Range</span>
                            </div>
                            <ul>
                                <li><strong>Week:</strong> Last 7 days of loaded data</li>
                                <li><strong>Month:</strong> Last 30 days</li>
                                <li><strong>Year:</strong> Last 365 days</li>
                                <li><strong>Full:</strong> Entire dataset</li>
                            </ul>
                            
                            <h4>Navigation Arrows (‚Üê ‚Üí)</h4>
                            <ul>
                                <li>Use <strong>arrow buttons</strong> to move forward/backward by the selected interval</li>
                                <li>Example: If "Week" is selected, arrows jump by 7 days, Monday is the start of the week</li>
                            </ul>
                            
                            <div class="info-box">
                                <strong>‚ÑπÔ∏è Demo Data Info:</strong> In the demo dataset, only <strong>year 2025</strong> contains complete data for both solar and grid meter files.
                            </div>
                            
                            <h4 style="margin-top: 30px;">Custom Date Range</h4>
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <p>Click the <strong>Start Date</strong> picker and select your desired start date and time</p>
                                    </div>
                                </div>
                                <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <p>Click the <strong>End Date</strong> picker and select your desired end date and time</p>
                                    </div>
                                </div>
                                <div class="help-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <p>Click the <strong>"Apply Range for Simulation"</strong> button to update all charts and prepare for simulation</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Important:</strong> The simulation period affects:
                                <ul>
                                    <li>All visualizations and charts</li>
                                    <li>Battery simulation calculations</li>
                                    <li>Self-consumption statistics</li>
                                    <li>Cost and savings calculations</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>‚è±Ô∏è Szimul√°ci√≥s id≈ëszak be√°ll√≠t√°sa</h3>
                            
                            <h4>Gyorsv√°laszt√≥ gombok</h4>
                            <div class="button-showcase">
                                <span class="demo-btn">Week</span>
                                <span class="demo-btn">Month</span>
                                <span class="demo-btn">Year</span>
                                <span class="demo-btn">Full Range</span>
                            </div>
                            <ul>
                                <li><strong>Week (H√©t):</strong> Utols√≥ 7 nap a bet√∂lt√∂tt adatokb√≥l</li>
                                <li><strong>Month (H√≥nap):</strong> Utols√≥ 30 nap</li>
                                <li><strong>Year (√âv):</strong> Utols√≥ 365 nap</li>
                                <li><strong>Full (Teljes):</strong> Teljes adathalmaz</li>
                            </ul>
                            
                            <h4>Navig√°ci√≥s nyilak (‚Üê ‚Üí)</h4>
                            <ul>
                                <li>Haszn√°ld a <strong>ny√≠l gombokat</strong> el≈ëre/h√°tra l√©p√©shez a kiv√°lasztott intervallum szerint</li>
                                <li>P√©lda: Ha "Week" van kiv√°lasztva, a nyilak 7 nappal l√©pnek, h√©tf≈ë a h√©t kezdete</li>
                            </ul>
                            
                            <div class="info-box">
                                <strong>‚ÑπÔ∏è Demo adatok info:</strong> A demo adathalmazban csak a <strong>2025-√∂s √©v</strong> tartalmaz teljes adatokat mind a napelemes, mind a h√°l√≥zati m√©r≈ë f√°jlokban.
                            </div>
                            
                            <h4 style="margin-top: 30px;">Egy√©ni id≈ëszak be√°ll√≠t√°sa</h4>
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <p>Kattints a <strong>Start Date</strong> v√°laszt√≥ra √©s v√°laszd ki a kezd≈ë d√°tumot √©s id≈ëpontot</p>
                                    </div>
                                </div>
                                <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <p>Kattints az <strong>End Date</strong> v√°laszt√≥ra √©s v√°laszd ki a befejez≈ë d√°tumot √©s id≈ëpontot</p>
                                    </div>
                                </div>
                                <div class="help-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <p>Kattints az <strong>"Apply Range for Simulation"</strong> gombra a grafikonok friss√≠t√©s√©hez √©s a szimul√°ci√≥ el≈ëk√©sz√≠t√©s√©hez</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="warning-box">
                                <strong>‚ö†Ô∏è Fontos:</strong> A szimul√°ci√≥s id≈ëszak befoly√°solja:
                                <ul>
                                    <li>Minden vizualiz√°ci√≥t √©s grafikont</li>
                                    <li>Akkumul√°tor szimul√°ci√≥s sz√°m√≠t√°sokat</li>
                                    <li>√ñnfogyaszt√°si statisztik√°kat</li>
                                    <li>K√∂lts√©g √©s megtakar√≠t√°s sz√°m√≠t√°sokat</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 3: Battery Configuration -->
                    <div id="section-battery-config" class="help-section" style="display:none;">
                        <div class="lang-en">
                            <h3>üîã Battery Parameters</h3>
                            
                            <div class="param-explain">
                                <h4>Capacity (kWh)</h4>
                                <p>Total energy storage capacity of the battery system.</p>
                                <ul>
                                    <li><strong>Typical residential:</strong> 5-15 kWh</li>
                                    <li><strong>Commercial:</strong> 20-100+ kWh</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>Charge/Discharge Efficiency (%)</h4>
                                <p>Energy losses during charging and discharging processes.</p>
                                <ul>
                                    <li><strong>Typical values:</strong> 90-96% per direction</li>
                                    <li><strong>Round-trip efficiency:</strong> Charge √ó Discharge (e.g., 96% √ó 92% = 88.3%)</li>
                                    <li>Higher is better (less energy loss)</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>Max Charge/Discharge Power (kW)</h4>
                                <p>Maximum rate at which the battery can charge or discharge.</p>
                                <ul>
                                    <li><strong>Max Charge:</strong> Limits how fast battery can charge from solar surplus</li>
                                    <li><strong>Max Discharge:</strong> Limits how fast battery can supply power to loads</li>
                                    <li>Typical C-rates: 0.5C to 1C (e.g., 10 kWh battery: 5-10 kW)</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>SOC Limits (Min/Max %)</h4>
                                <p>Operating range boundaries to protect battery health.</p>
                                <ul>
                                    <li><strong>Min SOC:</strong> Minimum allowed state of charge (typical: 10-20%)</li>
                                    <li><strong>Max SOC:</strong> Maximum allowed state of charge (typical: 85-95%)</li>
                                    <li><strong>Purpose:</strong> Extends battery lifespan and prevents damage</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>Inverter Mode</h4>
                                <p>How the system handles simultaneous import and export processes. Relevant for simulation logic.</p>
                                <ul>
                                    <li><strong>Asymmetric (Instantaneous "Netting" between import/export):</strong> Recommended for most systems, modern hybrid inverters</li>
                                    <li><strong>Symmetric:</strong> Separate import/export handling, for modeling older inverters</li>
                                    <li>See <em>"Key Concepts"</em> tab for detailed explanation</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>üîã Akkumul√°tor param√©terek</h3>
                            
                            <div class="param-explain">
                                <h4>Kapacit√°s (kWh)</h4>
                                <p>Az akkumul√°tor rendszer teljes energiat√°rol√°si kapacit√°sa.</p>
                                <ul>
                                    <li><strong>Tipikus h√°ztart√°si:</strong> 5-15 kWh</li>
                                    <li><strong>Kereskedelmi:</strong> 20-100+ kWh</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>T√∂lt√©si/Kis√ºt√©si hat√©konys√°g (%)</h4>
                                <p>Energia vesztes√©g a t√∂lt√©si √©s kis√ºt√©si folyamatok sor√°n.</p>
                                <ul>
                                    <li><strong>Tipikus √©rt√©kek:</strong> 90-96% ir√°nyank√©nt</li>
                                    <li><strong>K√∂rfolyamat hat√©konys√°g:</strong> T√∂lt√©s √ó Kis√ºt√©s (pl. 96% √ó 92% = 88,3%)</li>
                                    <li>Magasabb jobb (kevesebb vesztes√©g)</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>Max t√∂lt√©si/kis√ºt√©si teljes√≠tm√©ny (kW)</h4>
                                <p>Maxim√°lis sebess√©g, amellyel az akkumul√°tor t√∂lthet vagy mer√ºlhet.</p>
                                <ul>
                                    <li><strong>Max t√∂lt√©s:</strong> Korl√°tozza, milyen gyorsan t√∂lthet≈ë a napelem t√∂bbletb≈ël</li>
                                    <li><strong>Max kis√ºt√©s:</strong> Korl√°tozza, milyen gyorsan adhat energi√°t a fogyaszt√≥knak</li>
                                    <li>Tipikus C-r√°ta: 0,5C - 1C (pl. 10 kWh: 5-10 kW)</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>SOC korl√°tok (Min/Max %)</h4>
                                <p>M≈±k√∂d√©si tartom√°ny hat√°rai az akkumul√°tor v√©delme √©rdek√©ben.</p>
                                <ul>
                                    <li><strong>Min SOC:</strong> Minim√°lisan megengedett t√∂lt√∂tts√©g (tipikus: 10-20%)</li>
                                    <li><strong>Max SOC:</strong> Maxim√°lisan megengedett t√∂lt√∂tts√©g (tipikus: 85-95%)</li>
                                    <li><strong>C√©l:</strong> N√∂veli az √©lettartamot √©s v√©d a k√°rosod√°st√≥l</li>
                                </ul>
                            </div>
                            
                            <div class="param-explain">
                                <h4>Inverter m√≥d</h4>
                                <p>Hogyan kezeli a rendszer az egyidej≈± import √©s export folyamatokat. A szimul√°ci√≥ban kap szerepet. </p>
                                <ul>
                                    <li><strong>Aszimmetrikus (pillanatnyi "Nett√≥s√≠t√°s" import/export k√∂z√∂tt):</strong> Aj√°nlott legt√∂bb rendszerhez, az √∫jabb hibrid inverterek</li>
                                    <li><strong>Szimmetrikus:</strong> K√ºl√∂n import/export kezel√©s, r√©gebbi inverterek modellez√©s√©hez</li>
                                    <li>L√°sd <em>"Fogalmak"</em> f√ºlet r√©szletes magyar√°zat√©rt</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 4: Running Simulation -->
                    <div id="section-simulation" class="help-section" style="display:none;">
                        <div class="lang-en">
                            <h3>‚öôÔ∏è Execute Battery Simulation</h3>
                            
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Configure Parameters</h4>
                                        <p>Set all battery parameters in the Battery Configuration section (see previous tab)</p>
                                    </div>
                                </div>
                                
                                <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Run Simulation</h4>
                                        <p>Click the <strong>"Run Battery Simulation"</strong> button</p>
                                        <p><em>Large datasets may take 5-10 seconds to calculate</em></p>
                                    </div>
                                </div>
                                
                                <div class="help-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Review Results</h4>
                                        <p>Results appear in multiple places:</p>
                                        <ul>
                                            <li>KPI cards at the top showing key metrics</li>
                                            <li>Updated timeline charts with battery behavior</li>
                                            <li>Detailed statistics and comparisons</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="margin-top: 40px;">üìä Understanding the Results</h3>
                            
                            <div class="kpi-explain">
                                <h4>Grid Import Reduction</h4>
                                <p>How much the battery reduces energy purchased from the grid.</p>
                                <ul>
                                    <li>Measured in kWh and as a percentage</li>
                                    <li>Higher values = better grid independence</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>Grid Export Reduction</h4>
                                <p>How much solar energy the battery stores instead of exporting to the grid.</p>
                                <ul>
                                    <li>Important for net-metering scenarios</li>
                                    <li>Stores excess solar for later use</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>Self-Consumption Improvement</h4>
                                <p>Increase in on-site solar energy usage thanks to battery storage.</p>
                                <ul>
                                    <li>Shows before/after comparison</li>
                                    <li>Higher self-consumption = better economics</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>Battery Losses</h4>
                                <p>Energy lost due to charging/discharging inefficiencies.</p>
                                <ul>
                                    <li>Typical: 10-15% of energy cycled through battery</li>
                                    <li>Lower efficiency batteries have higher losses</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>Cost Savings</h4>
                                <p>Financial benefit of using battery storage.</p>
                                <ul>
                                    <li>Compares scenario with and without battery</li>
                                    <li>Based on import/export electricity prices</li>
                                    <li>Does not include battery investment cost</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>‚öôÔ∏è Akkumul√°tor szimul√°ci√≥ futtat√°sa</h3>
                            
                            <div class="help-steps">
                                <div class="help-step">
                                    <div class="step-number">1</div>
                                    <div class="step-content">
                                        <h4>Param√©terek be√°ll√≠t√°sa</h4>
                                        <p>√Åll√≠tsd be az akkumul√°tor param√©tereket a Battery Configuration r√©szben (el≈ëz≈ë f√ºl)</p>
                                    </div>
                                </div>
                                
                                <div class="help-step">
                                    <div class="step-number">2</div>
                                    <div class="step-content">
                                        <h4>Szimul√°ci√≥ ind√≠t√°sa</h4>
                                        <p>Kattints a <strong>"Run Battery Simulation"</strong> gombra</p>
                                        <p><em>Nagy adathalmazok eset√©n 5-10 m√°sodpercet vehet ig√©nybe</em></p>
                                    </div>
                                </div>
                                
                                <div class="help-step">
                                    <div class="step-number">3</div>
                                    <div class="step-content">
                                        <h4>Eredm√©nyek √°ttekint√©se</h4>
                                        <p>Az eredm√©nyek t√∂bb helyen jelennek meg:</p>
                                        <ul>
                                            <li>KPI k√°rty√°k fel√ºl a legfontosabb m√©r≈ësz√°mokkal</li>
                                            <li>Friss√≠tett id≈ëvonal grafikonok az akkumul√°tor viselked√©s√©vel</li>
                                            <li>R√©szletes statisztik√°k √©s √∂sszehasonl√≠t√°sok</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 style="margin-top: 40px;">üìä Eredm√©nyek √©rtelmez√©se</h3>
                            
                            <div class="kpi-explain">
                                <h4>H√°l√≥zati v√°s√°rl√°s cs√∂kken√©s</h4>
                                <p>Mennyivel cs√∂kkenti az akkumul√°tor a h√°l√≥zatr√≥l v√°s√°rolt energi√°t.</p>
                                <ul>
                                    <li>kWh-ban √©s sz√°zal√©kban m√©rve</li>
                                    <li>Magasabb √©rt√©k = jobb h√°l√≥zati f√ºggetlens√©g</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>H√°l√≥zati export cs√∂kken√©s</h4>
                                <p>Mennyi napelemes energi√°t t√°rol az akkumul√°tor h√°l√≥zatba t√°pl√°l√°s helyett.</p>
                                <ul>
                                    <li>Fontos brutt√≥ elsz√°mol√°sos esetekben</li>
                                    <li>T√∂bblet napenergi√°t k√©s≈ëbbi haszn√°latra t√°rolja</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>√ñnfogyaszt√°s n√∂veked√©s</h4>
                                <p>Helyben haszn√°lt napenergia n√∂veked√©se az akkumul√°tor t√°rol√°snak k√∂sz√∂nhet≈ëen.</p>
                                <ul>
                                    <li>El≈ëtte/ut√°na √∂sszehasonl√≠t√°st mutat</li>
                                    <li>Magasabb √∂nfogyaszt√°s = jobb gazdas√°goss√°g</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>Akkumul√°tor vesztes√©gek</h4>
                                <p>T√∂lt√©si/kis√ºt√©si hat√©konys√°gi vesztes√©gek miatt elveszett energia.</p>
                                <ul>
                                    <li>Tipikusan: 10-15% az akkumul√°toron √°tfoly√≥ energi√°b√≥l</li>
                                    <li>Alacsonyabb hat√©konys√°g√∫ akkumul√°torok nagyobb vesztes√©ggel j√°rnak</li>
                                </ul>
                            </div>
                            
                            <div class="kpi-explain">
                                <h4>K√∂lts√©g megtakar√≠t√°s</h4>
                                <p>Akkumul√°tor haszn√°lat p√©nz√ºgyi el≈ënye.</p>
                                <ul>
                                    <li>√ñsszehasonl√≠tja az akkumul√°toros √©s akkumul√°tor n√©lk√ºli forgat√≥k√∂nyvet</li>
                                    <li>Import/export √°ram√°rak alapj√°n</li>
                                    <li>Nem tartalmazza az akkumul√°tor beruh√°z√°si k√∂lts√©g√©t</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 5: Key Concepts -->
                    <div id="section-concepts" class="help-section" style="display:none;">
                        <div class="lang-en">
                            <h3>üîã Inverter Mode: Symmetric vs Asymmetric</h3>
                            
                            <p class="concept-intro"><strong>This refers to the inverter's hardware capability, not the billing method!</strong> The inverter type determines how it handles simultaneous import and export flows across phases.</p>
                            
                            <div class="concept-box concept-highlight">
                                <h4>Asymmetric (Instantaneous "Netting" between import/export) - Default ‚úì</h4>
                                <p>Modern hybrid inverters that can dynamically distribute production across phases optimally upto the instantaneous total solar power.</p>
                                
                                <strong>How it works:</strong>
                                <ul>
                                    <li>Inverter can <strong>feed different power levels to each phase</strong></li>
                                    <li>If L1 phase measures 2 kW import, it feeds 2 kW there</li>
                                    <li>If L2 phase measures 1 kW import, it feeds 1 kW there</li>
                                    <li>Production dynamically adjusts to match phase-specific consumption</li>
                                    <li>This is <strong>netting at energy flow level</strong> (not billing!)</li>
                                </ul>
                                
                                <div class="example-box">
                                    <strong>Example for three-phase system:</strong><br>
                                    ‚Ä¢ L1 phase: 3 kW consumption ‚Üí inverter feeds 3 kW<br>
                                    ‚Ä¢ L2 phase: 1 kW consumption ‚Üí inverter feeds 1 kW<br>
                                    ‚Ä¢ L3 phase: 0.5 kW consumption ‚Üí inverter feeds 0.5 kW<br>
                                    <strong>Result:</strong> Minimal grid import, optimal self-consumption
                                </div>
                                
                                <strong>Recommended for:</strong>
                                <ul>
                                    <li>‚úì Modern hybrid inverters (manufactured after 2020)</li>
                                    <li>‚úì Most residential and commercial installations</li>
                                    <li>‚úì Systems with unbalanced phase consumption</li>
                                </ul>
                            </div>
                            
                            <div class="concept-box">
                                <h4>Symmetric (Limited phase handling)</h4>
                                <p>Older inverters that <strong>cannot feed different power to each phase</strong>.</p>
                                
                                <strong>How it works:</strong>
                                <ul>
                                    <li>Inverter feeds <strong>equal power to all phases</strong></li>
                                    <li>Cannot adapt production to phase-specific imports</li>
                                    <li>If one phase has surplus and another deficit, cannot compensate</li>
                                    <li>Import and export can occur simultaneously (on different phases)</li>
                                </ul>
                                
                                <div class="example-box">
                                    <strong>Example for three-phase system:</strong><br>
                                    ‚Ä¢ Inverter production: 3 √ó 1.5 kW = 4.5 kW (evenly distributed)<br>
                                    ‚Ä¢ L1 phase: 3 kW consumption - 1.5 kW production = <span style="color:#ef4444">1.5 kW import</span><br>
                                    ‚Ä¢ L2 phase: 1 kW consumption - 1.5 kW production = <span style="color:#22c55e">0.5 kW export</span><br>
                                    ‚Ä¢ L3 phase: 0.5 kW consumption - 1.5 kW production = <span style="color:#22c55e">1 kW export</span><br>
                                    <strong>Result:</strong> Simultaneous import AND export, lower efficiency
                                </div>
                                
                                <strong>When to use:</strong>
                                <ul>
                                    <li>‚úì Modeling older inverters (pre-2020 systems)</li>
                                    <li>‚úì If you know your inverter does NOT support asymmetric feeding</li>
                                    <li>‚úì Conservative estimates (shows lower savings)</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üí∞ Financial Terms</h3>
                            
                            <div class="term-definition">
                                <h4>Self-Consumption</h4>
                                <p>Solar energy used directly on-site without going through the grid or battery.</p>
                                <ul>
                                    <li>Most valuable use of solar energy</li>
                                    <li>Saves money by avoiding grid import costs</li>
                                    <li>Higher self-consumption = better economics</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Grid Import</h4>
                                <p>Energy purchased from the grid when solar production insufficient.</p>
                                <ul>
                                    <li>Costs money based on electricity rates</li>
                                    <li>Battery helps reduce this by storing solar for later</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Grid Export</h4>
                                <p>Excess solar energy sent to the grid.</p>
                                <ul>
                                    <li>May receive credit (net-metering) or payment (feed-in tariff)</li>
                                    <li>Often compensated at lower rate than import cost</li>
                                    <li>Battery can store this instead of exporting</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Tier1 Import Limit (Progressive Pricing)</h4>
                                <p>Annual electricity quota with preferential pricing for grid imports.</p>
                                <ul>
                                    <li><strong>Tier1 (Discounted):</strong> First 2,523 kWh/year at lower rate (e.g., 36 HUF/kWh)</li>
                                    <li><strong>Tier2 (Market):</strong> Imports above limit at higher rate (e.g., 70 HUF/kWh)</li>
                                    <li><strong>Automatic adjustment:</strong> For partial-year simulations, limit is scaled proportionally</li>
                                    <li><strong>Example:</strong> 3-month simulation ‚Üí 2,523 √ó (90/365) ‚âà 622 kWh Tier1 limit</li>
                                </ul>
                                <div class="example-box" style="margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.1); border-left: 3px solid #4CAF50; border-radius: 3px;">
                                    <strong>üí° Practical Example:</strong><br>
                                    ‚Ä¢ Annual limit: 2,523 kWh<br>
                                    ‚Ä¢ 30-day simulation: 2,523 √ó (30/365) ‚âà 207 kWh<br>
                                    ‚Ä¢ First 207 kWh imported at Tier1 price, excess at Tier2 price
                                </div>
                                
                                <details class="technical-details">
                                    <summary style="cursor: pointer; font-weight: 600; margin-top: 10px;">üìê Detailed Calculation Method ‚ñº</summary>
                                    <div style="margin-top: 10px; padding-left: 15px;">
                                        <p><strong>Duration calculation:</strong></p>
                                        <code style="display: block; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 5px;">durationDays = (endDate - startDate) / (1000 √ó 60 √ó 60 √ó 24)</code>
                                        
                                        <p style="margin-top: 10px;"><strong>Proportional limit calculation:</strong></p>
                                        <code style="display: block; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 5px;">proportionalLimit = (durationDays / 365) √ó 2,523 kWh</code>
                                        
                                        <p style="margin-top: 10px;"><strong>Cumulative import tracking:</strong></p>
                                        <ul style="margin-top: 5px;">
                                            <li>Import is summed across all 15-minute intervals</li>
                                            <li>When cumulative import reaches limit ‚Üí switch to Tier2 price</li>
                                            <li>Boundary-crossing interval is split: Tier1 portion + Tier2 portion</li>
                                        </ul>
                                        
                                        <p style="margin-top: 10px;"><strong>Edge cases:</strong></p>
                                        <ul>
                                            <li><strong>Missing data:</strong> Actual time span between timestamps is used, not row count</li>
                                            <li><strong>Sub-day periods:</strong> Formula still works (e.g., 12 hours ‚Üí 2,523 √ó 0.5/365 ‚âà 3.5 kWh)</li>
                                            <li><strong>Baseline reference:</strong> Baseline always uses original full dataset, only the evaluated period's limit is adjusted</li>
                                        </ul>
                                    </div>
                                </details>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üîå Technical Terms</h3>
                            
                            <div class="term-definition">
                                <h4>SOC (State of Charge)</h4>
                                <p>Battery fill level, expressed as percentage.</p>
                                <ul>
                                    <li>0% = completely empty</li>
                                    <li>100% = completely full</li>
                                    <li>Operating typically between 20-90% for longevity</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Power (kW) vs Energy (kWh)</h4>
                                <p>Two different but related concepts:</p>
                                <ul>
                                    <li><strong>Power (kW):</strong> Rate of energy flow - "speed"</li>
                                    <li><strong>Energy (kWh):</strong> Total amount over time - "distance"</li>
                                    <li><strong>Example:</strong> 10 kW for 2 hours = 20 kWh</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Round-trip Efficiency</h4>
                                <p>Total efficiency from charging to discharging.</p>
                                <ul>
                                    <li>Formula: Charge Efficiency √ó Discharge Efficiency</li>
                                    <li>Example: 96% √ó 92% = 88.3% round-trip</li>
                                    <li>Typical lithium batteries: 85-95%</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>üîã Inverter m√≥d: Szimmetrikus vs Aszimmetrikus</h3>
                            
                            <p class="concept-intro"><strong>Ez az inverter hardveres k√©pess√©g√©t jel√∂li.</strong> Az inverter t√≠pusa hat√°rozza meg, hogyan kezeli az egyidej≈± import √©s export folyamatokat a f√°zisok k√∂z√∂tt.</p>
                            
                            <div class="concept-box concept-highlight">
                                <h4>Aszimmetrikus (pillanatnyi "Nett√≥s√≠t√°s" import/export k√∂z√∂tt) - Alap√©rtelmezett ‚úì</h4>
                                <p>√öjabb hibrid inverterek, amelyek k√©pesek a pillanatnyi termel√©st optim√°lisan sz√©tosztani a f√°zisok k√∂z√∂tt.</p>
                                
                                <strong>Hogyan m≈±k√∂dik:</strong>
                                <ul>
                                    <li>Az inverter <strong>f√°zisonk√©nt elt√©r≈ë teljes√≠tm√©nyt</strong> tud bet√°pl√°lni az √∂sszteljes√≠tm√©nyen bel√ºl</li>
                                    <li>Ha L1 f√°zison 2 kW importot m√©r, oda 2 kW-ot t√°pl√°l be</li>
                                    <li>Ha L2 f√°zison 1 kW importot m√©r, oda 1 kW-ot t√°pl√°l be</li>
                                    <li>A termel√©s dinamikusan igazodik a f√°zisonk√©nti fogyaszt√°shoz</li>
                                    <li>Ez <strong>nett√≥s√≠t√°s az energia √°raml√°s szintj√©n</strong> (nem k√∂lts√©g elsz√°mol√°s!)</li>
                                </ul>
                                
                                <div class="example-box">
                                    <strong>P√©lda h√°romf√°zis√∫ rendszerre:</strong><br>
                                    ‚Ä¢ L1 f√°zis: 3 kW fogyaszt√°s ‚Üí inverter 3 kW-ot t√°pl√°l be<br>
                                    ‚Ä¢ L2 f√°zis: 1 kW fogyaszt√°s ‚Üí inverter 1 kW-ot t√°pl√°l be<br>
                                    ‚Ä¢ L3 f√°zis: 0.5 kW fogyaszt√°s ‚Üí inverter 0.5 kW-ot t√°pl√°l be<br>
                                    <strong>Eredm√©ny:</strong> Minim√°lis h√°l√≥zati import, optim√°lis √∂nfogyaszt√°s
                                </div>
                                
                                <strong>Aj√°nlott haszn√°lat:</strong>
                                <ul>
                                    <li>‚úì √öjabb hibrid inverterek (2020 ut√°n gy√°rtott rendszerek)</li>
                                    <li>‚úì Legt√∂bb modern lakoss√°gi √©s kereskedelmi telep√≠t√©s</li>
                                    <li>‚úì F√°zisonk√©nt elt√©r≈ë fogyaszt√°si mint√°kkal rendelkez≈ëk</li>
                                </ul>
                            </div>
                            
                            <div class="concept-box">
                                <h4>Szimmetrikus (Korl√°tozott f√°zis-kezel√©s)</h4>
                                <p>R√©gebbi inverterek, amelyek <strong>nem tudnak f√°zisonk√©nt elt√©r≈ëen bet√°pl√°lni</strong>.</p>
                                
                                <strong>Hogyan m≈±k√∂dik:</strong>
                                <ul>
                                    <li>Az inverter <strong>minden f√°zisra egyforma teljes√≠tm√©nyt</strong> t√°pl√°l be</li>
                                    <li>Nem tudja a termel√©st a f√°zisonk√©nti importhoz igaz√≠tani</li>
                                    <li>Ha az egyik f√°zison t√∂bblet, m√°sikon hi√°ny van, nem tud kompenz√°lni</li>
                                    <li>Import √©s export egyszerre is el≈ëfordulhat (k√ºl√∂nb√∂z≈ë f√°zisokon)</li>
                                </ul>
                                
                                <div class="example-box">
                                    <strong>P√©lda h√°romf√°zis√∫ rendszerre:</strong><br>
                                    ‚Ä¢ Inverter termel√©s: 3 x 1.5 kW = 4.5 kW (egyenletesen sz√©tosztva)<br>
                                    ‚Ä¢ L1 f√°zis: 3 kW fogyaszt√°s - 1.5 kW termel√©s = <span style="color:#ef4444">1.5 kW import</span><br>
                                    ‚Ä¢ L2 f√°zis: 1 kW fogyaszt√°s - 1.5 kW termel√©s = <span style="color:#22c55e">0.5 kW export</span><br>
                                    ‚Ä¢ L3 f√°zis: 0.5 kW fogyaszt√°s - 1.5 kW termel√©s = <span style="color:#22c55e">1 kW export</span><br>
                                    <strong>Eredm√©ny:</strong> Egyidej≈± import √âS export, alacsonyabb hat√©konys√°g
                                </div>
                                
                                <strong>Mikor haszn√°ljuk:</strong>
                                <ul>
                                    <li>‚úì R√©gebbi inverterek modellez√©s√©hez (2020 el≈ëtti rendszerek)</li>
                                    <li>‚úì Ha biztosan tudod, hogy az invertere NEM t√°mogatja az aszimmetrikus bet√°pl√°l√°st</li>
                                    <li>‚úì Konzervativ becsl√©shez (alacsonyabb megtakar√≠t√°st mutat)</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üí∞ P√©nz√ºgyi fogalmak</h3>
                            
                            <div class="term-definition">
                                <h4>√ñnfogyaszt√°s</h4>
                                <p>Napelemes energia k√∂zvetlen√ºl helyben haszn√°lva, h√°l√≥zat vagy akkumul√°tor √©rint√©se n√©lk√ºl.</p>
                                <ul>
                                    <li>Napenergia leg√©rt√©kesebb felhaszn√°l√°sa</li>
                                    <li>P√©nzt takar√≠t meg h√°l√≥zati v√°s√°rl√°s elker√ºl√©s√©vel</li>
                                    <li>Magasabb √∂nfogyaszt√°s = jobb gazdas√°goss√°g</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>H√°l√≥zati v√°s√°rl√°s (Import)</h4>
                                <p>H√°l√≥zatr√≥l v√°s√°rolt energia amikor a napelem termel√©s nem elegend≈ë.</p>
                                <ul>
                                    <li>K√∂lts√©g az √°ram√°rfolyam alapj√°n</li>
                                    <li>Akkumul√°tor seg√≠t cs√∂kkenteni napenergia k√©s≈ëbbi haszn√°lattal</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>H√°l√≥zati export</h4>
                                <p>T√∂bblet napenergia h√°l√≥zatba t√°pl√°lva.</p>
                                <ul>
                                    <li>Kompenz√°ci√≥ nett√≥ elsz√°mol√°ssal vagy bet√°pl√°l√°si d√≠jjal</li>
                                    <li>Gyakran alacsonyabb d√≠jaz√°s mint a v√°s√°rl√°si √°r</li>
                                    <li>Akkumul√°tor t√°rolhatja export helyett</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Tier1 Import Limit (Kedvezm√©nyes S√°vhat√°r)</h4>
                                <p>Az √©ves villamosenergia kv√≥ta, amelyen bel√ºl kedvezm√©nyes √°r√∫ elektromoss√°got v√°s√°rolhatsz a h√°l√≥zatr√≥l.</p>
                                <ul>
                                    <li><strong>Tier1 (Kedvezm√©nyes):</strong> Az els≈ë 2523 kWh/√©v import alacsonyabb √°ron (pl. 36 Ft/kWh)</li>
                                    <li><strong>Tier2 (Piaci):</strong> A limit feletti import magasabb √°ron (pl. 70 Ft/kWh)</li>
                                    <li><strong>Automatikus ar√°nyos√≠t√°s:</strong> R√∂vid id≈ëszakra (pl. 1 h√≥nap, 1 h√©t) a rendszer automatikusan ar√°nyos√≠tja a limitet</li>
                                    <li><strong>P√©lda:</strong> 3 h√≥nap szimul√°ci√≥ ‚Üí 2523 √ó (90/365) ‚âà 622 kWh Tier1 limit</li>
                                </ul>
                                <div class="example-box" style="margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.1); border-left: 3px solid #4CAF50; border-radius: 3px;">
                                    <strong>üí° Gyakorlati p√©lda:</strong><br>
                                    ‚Ä¢ √âves limit: 2523 kWh<br>
                                    ‚Ä¢ 30 napos szimul√°ci√≥: 2523 √ó (30/365) ‚âà 207 kWh<br>
                                    ‚Ä¢ Els≈ë 207 kWh import Tier1 √°ron, az azt meghalad√≥ Tier2 √°ron
                                </div>
                                
                                <details class="technical-details">
                                    <summary style="cursor: pointer; font-weight: 600; margin-top: 10px;">üìê R√©szletes sz√°m√≠t√°si m√≥dszer ‚ñº</summary>
                                    <div style="margin-top: 10px; padding-left: 15px;">
                                        <p><strong>Id≈ëtartam sz√°m√≠t√°s:</strong></p>
                                        <code style="display: block; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 5px;">durationDays = (endDate - startDate) / (1000 √ó 60 √ó 60 √ó 24)</code>
                                        
                                        <p style="margin-top: 10px;"><strong>Ar√°nyos limit sz√°m√≠t√°s:</strong></p>
                                        <code style="display: block; background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 0.9em; margin-top: 5px;">proportionalLimit = (durationDays / 365) √ó 2523 kWh</code>
                                        
                                        <p style="margin-top: 10px;"><strong>Kumulat√≠v import k√∂vet√©s:</strong></p>
                                        <ul style="margin-top: 5px;">
                                            <li>Minden 15 perces intervallumon kereszt√ºl √∂sszes√≠tj√ºk az importot</li>
                                            <li>Amikor a kumulat√≠v import el√©ri a limitet ‚Üí √°tv√°lt√°s Tier2 √°rra</li>
                                            <li>A hat√°r√°tl√©p≈ë intervallum kett√©osztva: Tier1 + Tier2 r√©szre</li>
                                        </ul>
                                        
                                        <p style="margin-top: 10px;"><strong>Edge case-ek:</strong></p>
                                        <ul>
                                            <li><strong>Hi√°nyos adatok:</strong> Az id≈ëb√©lyegek k√∂z√∂tti t√©nyleges id≈ëtartam sz√°m√≠t, nem a sorok sz√°ma</li>
                                            <li><strong>1 napn√°l r√∂videbb:</strong> A k√©plet m≈±k√∂dik (pl. 12 √≥ra ‚Üí 2523 √ó 0.5/365 ‚âà 3.5 kWh)</li>
                                            <li><strong>Baseline referencia:</strong> A baseline mindig az eredeti teljes adatsorra vonatkozik, csak a vizsg√°lt id≈ëszak limitje v√°ltozik</li>
                                        </ul>
                                    </div>
                                </details>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üîå M≈±szaki fogalmak</h3>
                            
                            <div class="term-definition">
                                <h4>SOC (T√∂lt√∂tts√©gi √°llapot)</h4>
                                <p>Akkumul√°tor tel√≠tetts√©gi szint, sz√°zal√©kban kifejezve.</p>
                                <ul>
                                    <li>0% = teljesen √ºres</li>
                                    <li>100% = teljesen teli</li>
                                    <li>M≈±k√∂d√©s tipikusan 20-90% k√∂z√∂tt az √©lettartam √©rdek√©ben</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>Teljes√≠tm√©ny (kW) vs Energia (kWh)</h4>
                                <p>K√©t k√ºl√∂nb√∂z≈ë, de kapcsol√≥d√≥ fogalom:</p>
                                <ul>
                                    <li><strong>Teljes√≠tm√©ny (kW):</strong> Energia √°raml√°s sebess√©ge - "sebess√©g"</li>
                                    <li><strong>Energia (kWh):</strong> √ñsszmennyis√©g id≈ëben - "t√°vols√°g"</li>
                                    <li><strong>P√©lda:</strong> 10 kW 2 √≥r√°n √°t = 20 kWh</li>
                                </ul>
                            </div>
                            
                            <div class="term-definition">
                                <h4>K√∂rfolyamat hat√©konys√°g</h4>
                                <p>Teljes hat√©konys√°g t√∂lt√©st≈ël a kis√ºt√©sig.</p>
                                <ul>
                                    <li>K√©plet: T√∂lt√©si hat√©konys√°g √ó Kis√ºt√©si hat√©konys√°g</li>
                                    <li>P√©lda: 96% √ó 92% = 88,3% k√∂rfolyamat</li>
                                    <li>Tipikus l√≠tium akkumul√°tor: 85-95%</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Section 6: Troubleshooting -->
                    <div id="section-troubleshoot" class="help-section" style="display:none;">
                        <div class="lang-en">
                            <h3>‚ùì Common Issues & Solutions</h3>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Data Not Loading</h4>
                                <p><strong>Possible causes:</strong></p>
                                <ul>
                                    <li>Incorrect file format (must be CSV)</li>
                                    <li>Wrong number of columns</li>
                                    <li>Invalid timestamp format</li>
                                    <li>Missing or corrupted data</li>
                                </ul>
                                <p><strong>Solutions:</strong></p>
                                <ul>
                                    <li>‚úì Check file format: CSV with correct columns</li>
                                    <li>‚úì Verify timestamp format: <code>YYYY-MM-DD HH:mm</code></li>
                                    <li>‚úì Ensure 15-minute intervals throughout</li>
                                    <li>‚úì Check for missing values or gaps in data</li>
                                    <li>‚úì Try demo data to verify application is working</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Charts Not Updating</h4>
                                <p><strong>Solutions:</strong></p>
                                <ul>
                                    <li>‚úì Click <strong>"Apply Range"</strong> after changing dates</li>
                                    <li>‚úì Run simulation after changing battery parameters</li>
                                    <li>‚úì Refresh browser if charts appear frozen (F5)</li>
                                    <li>‚úì Check browser console for errors (F12)</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Simulation Taking Too Long</h4>
                                <p><strong>This is normal for:</strong></p>
                                <ul>
                                    <li>Large datasets (>1 year may take 5-10 seconds)</li>
                                    <li>First simulation after loading data</li>
                                </ul>
                                <p><strong>Solutions:</strong></p>
                                <ul>
                                    <li>‚úì Reduce time range for faster calculation</li>
                                    <li>‚úì Be patient with large datasets</li>
                                    <li>‚úì Check browser console for errors (F12)</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Unexpected or Unrealistic Results</h4>
                                <p><strong>Check these settings:</strong></p>
                                <ul>
                                    <li>‚úì Verify battery parameters are realistic</li>
                                    <li>‚úì Capacity must be > 0</li>
                                    <li>‚úì Efficiency values between 80-100%</li>
                                    <li>‚úì Min SOC < Max SOC</li>
                                    <li>‚úì Charge/discharge rates appropriate for battery size</li>
                                    <li>‚úì Try demo data to verify application working correctly</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üíª Browser Compatibility</h3>
                            <div class="browser-compat">
                                <p><strong>Supported browsers:</strong></p>
                                <ul>
                                    <li>‚úÖ Chrome (latest version)</li>
                                    <li>‚úÖ Firefox (latest version)</li>
                                    <li>‚úÖ Microsoft Edge (latest version)</li>
                                    <li>‚úÖ Safari 14+</li>
                                    <li>‚ùå Internet Explorer (not supported)</li>
                                </ul>
                                <p><strong>Requirements:</strong></p>
                                <ul>
                                    <li>JavaScript must be enabled</li>
                                    <li>Cookies/LocalStorage enabled (for preferences)</li>
                                    <li>Modern browser with HTML5 support</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üìö Need More Help?</h3>
                            <p><em>Note: This is a hobby project. I'm not actively maintaining it as a developer, but you're welcome to explore and modify the code.</em></p>
                            <ul>
                                <li>üìß <strong>Documentation:</strong> Check README.md for detailed technical information</li>
                                <li>üêõ <strong>Bug Reports:</strong> Submit issues on GitHub repository</li>
                                <li>üí° <strong>Feature Requests:</strong> We welcome your suggestions!</li>
                                <li>üîß <strong>Development:</strong> Check implementation notes in docs folder</li>
                            </ul>
                        </div>
                        
                        <div class="lang-hu" style="display:none;">
                            <h3>‚ùì Gyakori probl√©m√°k & megold√°sok</h3>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Adat nem t√∂lt≈ëdik be</h4>
                                <p><strong>Lehets√©ges okok:</strong></p>
                                <ul>
                                    <li>Helytelen f√°jl form√°tum (CSV kell)</li>
                                    <li>Rossz oszlopsz√°m</li>
                                    <li>√ârv√©nytelen id≈ëb√©lyeg form√°tum</li>
                                    <li>Hi√°nyz√≥ vagy s√©r√ºlt adatok</li>
                                </ul>
                                <p><strong>Megold√°sok:</strong></p>
                                <ul>
                                    <li>‚úì Ellen≈ërizd a f√°jl form√°tumot: CSV megfelel≈ë oszlopokkal</li>
                                    <li>‚úì Id≈ëb√©lyeg form√°tum: <code>√â√â√â√â-HH-NN √ì√ì:pp</code></li>
                                    <li>‚úì 15 perces felbont√°s v√©gig biztos√≠t√°sa</li>
                                    <li>‚úì Hi√°nyz√≥ √©rt√©kek vagy r√©sek ellen≈ërz√©se</li>
                                    <li>‚úì Pr√≥b√°ld ki a demo adatokat hogy az alkalmaz√°s m≈±k√∂dik</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Grafikonok nem friss√ºlnek</h4>
                                <p><strong>Megold√°sok:</strong></p>
                                <ul>
                                    <li>‚úì Kattints <strong>"Apply Range"</strong>-re d√°tum v√°ltoztat√°s ut√°n</li>
                                    <li>‚úì Futtasd a szimul√°ci√≥t param√©ter v√°ltoztat√°s ut√°n</li>
                                    <li>‚úì Friss√≠tsd a b√∂ng√©sz≈ët ha grafikonok lefagytak (F5)</li>
                                    <li>‚úì Ellen≈ërizd a b√∂ng√©sz≈ë konzolt hib√°k√©rt (F12)</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ Szimul√°ci√≥ t√∫l lass√∫</h4>
                                <p><strong>Ez norm√°lis ilyenkor:</strong></p>
                                <ul>
                                    <li>Nagy adathalmazok (>1 √©v 5-10 m√°sodpercet vehet ig√©nybe)</li>
                                    <li>Els≈ë szimul√°ci√≥ adatok bet√∂lt√©se ut√°n</li>
                                </ul>
                                <p><strong>Megold√°sok:</strong></p>
                                <ul>
                                    <li>‚úì Cs√∂kkentsd az id≈ëtartom√°nyt gyorsabb sz√°m√≠t√°shoz</li>
                                    <li>‚úì L√©gy t√ºrelmes nagy adathalmazokn√°l</li>
                                    <li>‚úì Ellen≈ërizd a b√∂ng√©sz≈ë konzolt hib√°k√©rt (F12)</li>
                                </ul>
                            </div>
                            
                            <div class="troubleshoot-item">
                                <h4>üî¥ V√°ratlan vagy irre√°lis eredm√©nyek</h4>
                                <p><strong>Ellen≈ërizd ezeket a be√°ll√≠t√°sokat:</strong></p>
                                <ul>
                                    <li>‚úì Az akkumul√°tor param√©terek re√°lisak</li>
                                    <li>‚úì Kapacit√°s > 0</li>
                                    <li>‚úì Hat√©konys√°g √©rt√©kek 80-100% k√∂z√∂tt</li>
                                    <li>‚úì Min SOC < Max SOC</li>
                                    <li>‚úì T√∂lt√©si/kis√ºt√©si sebess√©g megfelel≈ë az akkumul√°tor m√©ret√©hez</li>
                                    <li>‚úì Pr√≥b√°ld ki a demo adatokat hogy az alkalmaz√°s j√≥l m≈±k√∂dik</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üíª B√∂ng√©sz≈ë kompatibilit√°s</h3>
                            <div class="browser-compat">
                                <p><strong>T√°mogatott b√∂ng√©sz≈ëk:</strong></p>
                                <ul>
                                    <li>‚úÖ Chrome (legfrissebb verzi√≥)</li>
                                    <li>‚úÖ Firefox (legfrissebb verzi√≥)</li>
                                    <li>‚úÖ Microsoft Edge (legfrissebb verzi√≥)</li>
                                    <li>‚úÖ Safari 14+</li>
                                    <li>‚ùå Internet Explorer (nem t√°mogatott)</li>
                                </ul>
                                <p><strong>K√∂vetelm√©nyek:</strong></p>
                                <ul>
                                    <li>JavaScript enged√©lyezve kell legyen</li>
                                    <li>Cookies/LocalStorage enged√©lyezve (preferenci√°khoz)</li>
                                    <li>Modern b√∂ng√©sz≈ë HTML5 t√°mogat√°ssal</li>
                                </ul>
                            </div>
                            
                            <hr style="margin: 30px 0;">
                            
                            <h3>üìö Tov√°bbi seg√≠ts√©g?</h3>
                            <p><em>Megjegyz√©s: Ez egy hobbi projektk√©nt k√©sz√ºlt. Nem vagyok akt√≠v mint fejleszt≈ë, de b√°tran fedezd fel √©s m√≥dos√≠tsd a k√≥dot.</em></p>
                            <ul>
                                <li>üìß <strong>Dokument√°ci√≥:</strong> README.md r√©szletes m≈±szaki inform√°ci√≥k√©rt</li>
                                <li>üêõ <strong>Hibajelent√©sek:</strong> GitHub repository-ban jelenthetsz be hib√°kat</li>
                                <li>üí° <strong>Funkci√≥ javaslatok:</strong> Javaslataidat v√°rjuk sz√≠vesen!</li>
                                <li>üîß <strong>Fejleszt√©s:</strong> Implement√°ci√≥s jegyzeteket a docs mapp√°ban tal√°lod</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/csv_handler.js"></script>
    <script src="js/data_merger.js"></script>
    <script src="js/visualizer.js"></script>
    <script src="js/simulation.js"></script>
    <script src="js/help_modal.js"></script>
    <script src="js/app.js"></script>
    <script>
        const version = 'v1.0.0';
        const buildDate = new Date();
        document.getElementById('version-info').innerText = `Version: ${version} - Last Updated: ${buildDate.toLocaleString()}`;
    </script>
</body>
</html>